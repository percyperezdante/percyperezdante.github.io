<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.68.0-DEV" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Networking :: Home</title>

    
    <link href="/css/nucleus.css?1613331106" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1613331106" rel="stylesheet">
    <link href="/css/hybrid.css?1613331106" rel="stylesheet">
    <link href="/css/featherlight.min.css?1613331106" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1613331106" rel="stylesheet">
    <link href="/css/auto-complete.css?1613331106" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1613331106" rel="stylesheet">
    <link href="/css/theme.css?1613331106" rel="stylesheet">
    <link href="/css/hugo-theme.css?1613331106" rel="stylesheet">
    
      <link href="/css/theme-percy.css?1613331106" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1613331106"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

  </head>
  <body class="" data-url="/devops/gcp/networking/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/images/uyuni.png" >
Uyuni
<br>
Percy Perez Aruni
<link rel="shortcut icon" href="/images/whipala.png" type="image/x-icon" />

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1613331106"></script>
<script type="text/javascript" src="/js/auto-complete.js?1613331106"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/example.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1613331106"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/projects/" title="Projects" class="dd-item 
        
        
        
        ">
      <a href="/projects/">
          <b>1. </b>Projects
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/devops/" title="DevOps" class="dd-item 
        parent
        
        
        ">
      <a href="/devops/">
          <b>2. </b>DevOps
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/devops/gcp/" title="GCP" class="dd-item 
        parent
        
        
        ">
      <a href="/devops/gcp/">
          <b>2.1 </b>GCP
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/devops/gcp/networking/" title="Networking" class="dd-item active">
        <a href="/devops/gcp/networking/">
        Networking
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/devops/gcp/fundamentals/" title="Fundamentals" class="dd-item ">
        <a href="/devops/gcp/fundamentals/">
        Fundamentals
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/devops/aws/" title="AWS" class="dd-item 
        
        
        
        ">
      <a href="/devops/aws/">
          <b>2.2</b>AWS
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/devops/aws/cloudpractitioner/" title="CloudPractitioner" class="dd-item 
        
        
        
        ">
      <a href="/devops/aws/cloudpractitioner/">
          <b>2.2.1 </b>CloudPractitioner
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/devops/aws/cloudpractitioner/coreservices/" title="CoreServices" class="dd-item ">
        <a href="/devops/aws/cloudpractitioner/coreservices/">
        CoreServices
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/devops/aws/cloudpractitioner/fundamentals/" title="Fundamentals" class="dd-item ">
        <a href="/devops/aws/cloudpractitioner/fundamentals/">
        Fundamentals
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/devops/aws/devopseng/" title="DevopsEng" class="dd-item 
        
        
        
        ">
      <a href="/devops/aws/devopseng/">
          <b>2.2.2 </b>DevopsEng
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/devops/aws/devopseng/codecommitcmd/" title="Codecommitcmd" class="dd-item ">
        <a href="/devops/aws/devopseng/codecommitcmd/">
        Codecommitcmd
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/devops/aws/devopseng/ciautomation/" title="CIAutomation" class="dd-item ">
        <a href="/devops/aws/devopseng/ciautomation/">
        CIAutomation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/devops/cloudsecurity/" title="CloudSecurity" class="dd-item ">
        <a href="/devops/cloudsecurity/">
        CloudSecurity
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/devops/images/" title="Building Images" class="dd-item ">
        <a href="/devops/images/">
        Building Images
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/sre/" title="SRE" class="dd-item 
        
        
        
        ">
      <a href="/sre/">
          <b>3. </b>SRE
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/sre/mypostmortem/" title="Mypostmortem" class="dd-item ">
        <a href="/sre/mypostmortem/">
        Mypostmortem
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/review/" title="Review" class="dd-item ">
        <a href="/sre/review/">
        Review
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/myapproach/" title="Myapproach" class="dd-item ">
        <a href="/sre/myapproach/">
        Myapproach
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/sre/online/" title="Online resources" class="dd-item 
        
        
        
        ">
      <a href="/sre/online/">
          Online resources
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/sre/online/srecon2019/" title="SRECON 2019" class="dd-item ">
        <a href="/sre/online/srecon2019/">
        SRECON 2019
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/online/sre-mmr-week4/" title="SRE MMR Week4" class="dd-item ">
        <a href="/sre/online/sre-mmr-week4/">
        SRE MMR Week4
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/online/sre-mmr-week3/" title="SRE MMR Week3" class="dd-item ">
        <a href="/sre/online/sre-mmr-week3/">
        SRE MMR Week3
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/online/sre-mmr-week2/" title="SRE MMR Week2" class="dd-item ">
        <a href="/sre/online/sre-mmr-week2/">
        SRE MMR Week2
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/online/sre-mmr-week1/" title="SRE MMR Week1" class="dd-item ">
        <a href="/sre/online/sre-mmr-week1/">
        SRE MMR Week1
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/sre/references/" title="References" class="dd-item ">
        <a href="/sre/references/">
        References
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/notes/" title="Notes" class="dd-item 
        
        
        
        ">
      <a href="/notes/">
          <b>4. </b>Notes
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/notes/ansible/" title="Ansible" class="dd-item ">
        <a href="/notes/ansible/">
        Ansible
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/restful/" title="Restful" class="dd-item ">
        <a href="/notes/restful/">
        Restful
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/jfrog/" title="Jfrog" class="dd-item ">
        <a href="/notes/jfrog/">
        Jfrog
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/crypto/" title="Crypto" class="dd-item ">
        <a href="/notes/crypto/">
        Crypto
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/shell/" title="Shell" class="dd-item ">
        <a href="/notes/shell/">
        Shell
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/kubernetes/" title="Kubernetes" class="dd-item ">
        <a href="/notes/kubernetes/">
        Kubernetes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/notes/go/" title="Go" class="dd-item ">
        <a href="/notes/go/">
        Go
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/tools/" title="Tools" class="dd-item 
        
        
        
        ">
      <a href="/tools/">
          <b>5. </b>Tools
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/tools/installation/" title="Installation" class="dd-item ">
        <a href="/tools/installation/">
        Installation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/reproducibility/" title="Reproducibility" class="dd-item 
        
        
        
        ">
      <a href="/reproducibility/">
          <b>6. </b>Reproducibility
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/teaching/" title="Teaching" class="dd-item 
        
        
        
        ">
      <a href="/teaching/">
          <b>7. </b>Teaching
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/teaching/resources/" title="Resources" class="dd-item 
        
        
        
        ">
      <a href="/teaching/resources/">
          Resources
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/research/" title="Research" class="dd-item 
        
        
        
        ">
      <a href="/research/">
          <b>8. </b>Research
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/research/nmanet/" title="NManet" class="dd-item ">
        <a href="/research/nmanet/">
        NManet
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/blog/" title="Blog" class="dd-item 
        
        
        
        ">
      <a href="/blog/">
          <b>9. </b>Blog
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/funding/" title="Funding" class="dd-item 
        
        
        
        ">
      <a href="/funding/">
          <b>10. </b>Funding
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/devopssec/" title="DevOpsSec" class="dd-item 
        
        
        
        ">
      <a href="/devopssec/">
          <b>11. </b>DevOpsSec
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/devopssec/3h/" title="3h" class="dd-item 
        
        
        
        ">
      <a href="/devopssec/3h/">
          <b>11.1. </b>3h
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            




 
  
    
      <li data-nav-id="/devopssec/3h/general/" title="General" class="dd-item ">
        <a href="/devopssec/3h/general/">
        General
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Credits to: <br> <a href="https://getgrav.org">Grav</a>, <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/matcornic/hugo-theme-learn">Hugo-theme-learn</p>

<p><span id="datetime"></span></p>
<script>
var dt = new Date();
document.getElementById("datetime").innerHTML = dt.toLocaleString();
</script>


    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Home</a> > <a href='/devops/'>DevOps</a> > <a href='/devops/gcp/'>GCP</a> > Networking
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#vpc-virtual-private-cloud">VPC Virtual Private Cloud</a></li>
        <li><a href="#mutlple-network-interfaces">Mutlple network interfaces:</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Networking
            </h1>
          

        



<h3 id="vpc-virtual-private-cloud">VPC Virtual Private Cloud</h3>
<p>VPC is a set of GCP objects, such as:</p>
<ul>
<li>
<p>Project</p>
<ul>
<li>Associated to services and networks</li>
<li>Organize infrastructure resources</li>
<li>Link objects and services with billing</li>
<li>Contain networks, default up to 5</li>
<li>It containt entire networks</li>
</ul>
</li>
<li>
<p>Network: can be shared with other projects or peered, are global, and no ip address range</p>
<ul>
<li>Default
<ul>
<li>Every project</li>
<li>one subnet per region</li>
<li>Default firewall rules</li>
</ul>
</li>
<li>Auto
<ul>
<li>Default network</li>
<li>One subnet per region</li>
<li>Regional IP allocation</li>
<li>Fixed /20 subnet per region</li>
<li>Expandable to /16</li>
</ul>
</li>
<li>Custom
<ul>
<li>No default subnets created</li>
<li>Full control of IP ranges</li>
<li>Regional IP allocation</li>
<li>Expandable to any RFC 1918 size</li>
</ul>
</li>
</ul>
<p><img src="/devops/gcp/vpcnetworkexample1.png" alt="example of network isolation"></p>
<p>To connect to a on-premises network you can use a VPN gateway service from VPC. This is possible because VPC is global.
<img src="/devops/gcp/vpcconnecttoonprem.png" alt="VPC is global and connect to on-prem"></p>
</li>
<li>
<p>Subnets</p>
<ul>
<li>They work at REGIONAL scale.</li>
<li>VMs can be on same subnet but different zones</li>
<li>One single firewall rule can apply to both VMs</li>
<li>Every subnet has 4 reserved addresses:
<ul>
<li>x.0.0.0   Network</li>
<li>x.0.0.1   Subnet gateway</li>
<li>x.0.0.255 Broadcast</li>
<li>x.0.0.254 Primary used by Google ( second-to-last address )</li>
</ul>
</li>
<li>New subnets can not overlap with extisting subnets</li>
<li>New subnets address should be inside the <a href="https://tools.ietf.org/html/rfc1918">RFC 1918</a> address spaces</li>
<li>Subnets can expand, can not shrink. Start with small subnet ranges
<ul>
<li>To expand a subnet: GCP console -&gt; VPC Network -&gt; Click subnet -&gt; Click Edit -&gt; Modify the range in &ldquo;IP address range&rdquo;</li>
</ul>
</li>
<li>Automode can be expanded from /20 to /16</li>
<li>Avoid large subnets</li>
</ul>
<p><img src="/devops/gcp/vpcsubnetszones.png" alt="VPC subnets per zone"></p>
</li>
<li>
<p>Regions</p>
</li>
<li>
<p>Zones</p>
</li>
<li>
<p>Ip addresses</p>
<ul>
<li>
<p>Internal</p>
<ul>
<li>Allocated  from subnet range to VMs by DHCP</li>
<li>DHCP lease is renewed every 24 hours</li>
<li>VMs name + IP is registered with network scoeped DNS</li>
<li>VMs only see the internal IP, not the external.</li>
<li>The external IP is maped to the VM by VCP, but the OS of the VM does not know it.</li>
</ul>
</li>
<li>
<p>External</p>
<ul>
<li>Assigned from pool ( external ips are ephemeral by default )</li>
<li>Reserved (static) and billed more then not arrached to running VM</li>
<li>VM does not know external IP, it is mapped to internal</li>
<li>Admins can also publish public DNS records pointing to the instance
<ul>
<li>Public DNS records are not published automatically</li>
</ul>
</li>
<li>DNS zone can be hosted using Cloud DNS</li>
</ul>
</li>
<li>
<p>IP alias:</p>
<ul>
<li>Primary subnet: defines the subnet</li>
<li>Each VM gets its primary IP from this range</li>
<li>Swcondary ranges provide an organizational tool</li>
<li>The following files replace the _spf.google.com TXT records previously recommended to use for listing Google IP addresses.
<ul>
<li>
<p><a href="https://www.gstatic.com/ipranges/cloud.json:">https://www.gstatic.com/ipranges/cloud.json:</a>
Provides a JSON representation of Cloud IP addresses organized by region.</p>
</li>
<li>
<p><a href="https://www.gstatic.com/ipranges/cloud_geofeed">https://www.gstatic.com/ipranges/cloud_geofeed</a>
It is a standard geofeed formatted IP geolocation file that we share with 3rd-party IP geo providers like Maxmind, Neustar, and IP2Location.</p>
</li>
<li>
<p><a href="https://www.gstatic.com/ipranges/goog.json">https://www.gstatic.com/ipranges/goog.json</a> and <a href="https://www.gstatic.com/ipranges/goog.txt">https://www.gstatic.com/ipranges/goog.txt</a> are TXT and JSON formatted files respectively that include Google public prefixes in CIDR notation.</p>
</li>
<li>
<p>For more information as well as an example of how to use this information, refer to <a href="https://cloud.google.com/vpc/docs/configure-private-google-access#ip-addr-defaults">https://cloud.google.com/vpc/docs/configure-private-google-access#ip-addr-defaults</a></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>VMs</p>
<ul>
<li>Name resolution is handle by an internal DNS</li>
<li>Each VM has a hostname that can be resolve to an internal AP address.
<ul>
<li>FQDN= hostname.c.ProjectID.internal</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Routes</p>
<ul>
<li>A route is create when a network or subnet is created.</li>
<li>COnnections are allowed or denied at the instance level</li>
<li>Firewall rules are stateful, it means birectional communication</li>
<li>If firewall and rules are deleted, the deny all ingress and allow all egress are still aplied.</li>
</ul>
</li>
<li>
<p>Firewall rules</p>
<ul>
<li>Configure firewall by setting the following:
<ul>
<li>Direction:
<ul>
<li>Inbound connections are matched with &ldquo;ingress&rdquo; rules only</li>
<li>Outbound connection sre matched with &ldquo;egress&rdquo; rules only</li>
</ul>
</li>
<li>Source or destination:
<ul>
<li>For ingress: source = ip address, source tags or source service account</li>
<li>For egress: destination = rule with one or more ranges of ip addresses.</li>
</ul>
</li>
<li>Protocol, port</li>
<li>Action: allow or deny</li>
<li>Priority: Order on how rules are applied, first matching rule is applied.</li>
<li>Rule assignment: All rules are assigned to all instances, but you can assign ceratin rules to especific instances only</li>
</ul>
</li>
<li>Hierarchical firewall policies:
<ul>
<li>GCP uses &ldquo;go to_next&rdquo; to allow low level instances to evaluate the ingress/egress</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Example:</p>
<ul>
<li>
<p>Go to GCP console -&gt; click on VPC Networks</p>
</li>
<li>
<p>In the left pane, click Firewall rules. Notice that there are 4 Ingress firewall rules for the default network:</p>
<ul>
<li>
<p>default-allow-icmp =&gt; This allows you to ping from a VM to the external IP only.</p>
</li>
<li>
<p>default-allow-rdp</p>
</li>
<li>
<p>default-allow-ssh ==&gt; This allows you to ssh this VM. If you remove this and you wanted to ssh, you will see the following message:</p>
<blockquote>
<p>Please consider adding a firewall rule to allow ingress from the Cloud IAP for TCP forwarding netblock to the SSH port of your machine to start using Cloud IAP for TCP forwarding for better performance.  Learn more Dismiss</p>
</blockquote>
</li>
<li>
<p>default-allow-internal ==&gt; This allows you to ping between VMs in the same subnet</p>
</li>
<li>
<p>These firewall rules allow ICMP, RDP, and SSH ingress traffic from anywhere (0.0.0.0/0) and all TCP, UDP, and ICMP traffic within the network (10.128.0.0/9). The Targets, Filters, Protocols/ports, and Action columns explain these rules</p>
</li>
</ul>
</li>
<li>
<p>Note that if a VM has not network set, GCP does not allow to create it. You need to create a VPC network first, and that name should appear during the creation of the VM under the &quot; Management, security, disks, networking, sole tenancy &quot; tag.</p>
</li>
<li>
<p>To create a VPC network, you can choose auto mode with firewall rules:</p>
<ul>
<li>Click on VPC network, create VPC, Name it</li>
<li>For subnet creation mode, click &ldquo;automatic&rdquo;: Auto mode networks create subnets in each region automatically.</li>
<li>For Firewall rules, select all available rules. These are the same standard firewall rules that the default network had. The deny-all-ingress and allow-all-egress rules are also displayed, but you cannot check or uncheck them because they are implied. These two rules have a lower Priority (higher integers indicate lower priorities) so that the allow ICMP, internal, RDP and SSH rules are considered first.</li>
<li>Click create.</li>
<li>When VPC network is created note that a subnet was creatd for each region.</li>
<li>NOTE If you ever delete the default network, you can quickly re-create it by creating an auto mode network as you just did.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="mutlple-network-interfaces">Mutlple network interfaces:</h3>
<ul>
<li>
<p>VPC network is isolated by default:</p>
<ul>
<li>Communication inside VPC, though internal IP</li>
<li>Communication across networks, using external IP</li>
</ul>
</li>
<li>
<p>In multiple interfaces each NIC is attached to a different VPC network</p>
<ul>
<li>Usually 8 NICs are allowed peer VM
<ul>
<li>VM &lt;= 2vCPU, you can have 2 NICs</li>
<li>VM &gt;  2 vCPI, you can have 1 NIC per vCPU ( max 8)
<img src="/devops/gcp/vpcmultipleinterfaces.png" alt="Multiple interfacds"></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Excercise:</p>
</li>
<li>
<p>Command lines for network and subnets</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">To create a VPC netwok with custom subnets
$ gcloud compute networks create myvpcnet --project<span style="color:#f92672">=</span>myproject --subnet-mode<span style="color:#f92672">=</span>custom --mtu<span style="color:#f92672">=</span><span style="color:#ae81ff">1460</span> --bgp-routing-mode<span style="color:#f92672">=</span>regional
To create subnet
$ gcloud compute networks subnets create mysubnet --project<span style="color:#f92672">=</span>myproject --range<span style="color:#f92672">=</span>10.130.0.0/20 --network<span style="color:#f92672">=</span>myvpcnet --region<span style="color:#f92672">=</span>us-central1

To create mynet network. another approach
$ gcloud compute networks create mynet --subnet-mode<span style="color:#f92672">=</span>custom
To create a subnet called subnet1
$ gcloud compute networks subnets create subnet1 --network<span style="color:#f92672">=</span>mynet --region<span style="color:#f92672">=</span>us-central1 --range<span style="color:#f92672">=</span>172.16.0.0/24

To list available VPC networks
$ gcloud compute networks list

NAME           SUBNET_MODE  BGP_ROUTING_MODE  IPV4_RANGE  GATEWAY_IPV4
default        AUTO         REGIONAL
mynet1         CUSTOM       REGIONAL
mynet2         AUTO         REGIONAL
privatenet     CUSTOM       REGIONAL
  
To list subnets
$ gcloud compute networks subnets list
</code></pre></div><ul>
<li>NOTE: Instances on this network will not be reachable until firewall rules are created. As an example, you can allow all internal traffic between instances as well as SSH, RDP, and ICMP by running.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gcloud compute firewall-rules create &lt;FIREWALL_NAME&gt; --network privatenet --allow tcp,udp,icmp --source-ranges &lt;IP_RANGE&gt;
$ gcloud compute firewall-rules create &lt;FIREWALL_NAME&gt; --network privatenet --allow tcp:22,tcp:3389,icmp
</code></pre></div></li>
<li>default and mynetwork are auto mode networks and create subnets in each region automatically.</li>
<li>mynet1 and mynet2 are custom mode networks and start with no subnets, which gives you full control over subnet creation.</li>
<li>To list available subnets. Note that auto mode networks create default subnets,and custom mode create only manually created subnets</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gcloud compute networks subnets list --sort-by<span style="color:#f92672">=</span>NETWORK
</code></pre></div></li>
<li>
<p>Command line for firewall rules:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ gcloud compute firewall-rules create mynet-allow-icmp-ssh-rdp --direction<span style="color:#f92672">=</span>INGRESS --priority<span style="color:#f92672">=</span><span style="color:#ae81ff">1000</span> --network<span style="color:#f92672">=</span>mynet --action<span style="color:#f92672">=</span>ALLOW --rules<span style="color:#f92672">=</span>icmp,tcp:22,tcp:3389 --source-ranges<span style="color:#f92672">=</span>0.0.0.0/0
  
To list all available firewall rules
$ gcloud compute firewall-rules list --sort-by<span style="color:#f92672">=</span>NETWORK
</code></pre></div></li>
<li>
<p>Command line to create VM:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> $ gcloud compute instances create myvm --zone<span style="color:#f92672">=</span>us-central1-c --machine-type<span style="color:#f92672">=</span>n1-standard-1 --subnet<span style="color:#f92672">=</span>privatesubnet-us

 To list all VMs
 $ gcloud compute instances list --sort-by<span style="color:#f92672">=</span>ZONE

</code></pre></div></li>
</ul>
<p>gcloud beta compute &ndash;project=qwiklabs-gcp-00-f7be7ad6aa15 instances create managementnet-us-vm &ndash;zone=us-central1-c &ndash;machine-type=n1-standard-1 &ndash;subnet=managementsubnet-us &ndash;network-tier=PREMIUM &ndash;maintenance-policy=MIGRATE &ndash;<a href="mailto:service-account=344393310583-compute@developer.gserviceaccount.com">service-account=344393310583-compute@developer.gserviceaccount.com</a>
&ndash;scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append &ndash;image=debian-10-buster-v20210122 &ndash;image-project=debian-cloud &ndash;boot-disk-size=10GB &ndash;boot-disk-type=pd-balanced &ndash;boot-disk-device-name=managementnet-us-vm
&ndash;no-shielded-secure-boot &ndash;shielded-vtpm &ndash;shielded-integrity-monitoring &ndash;reservation-affinity=any</p>
<pre><code> - NOte that two VMs in the same VPC can ping each other, but not necessarily other VPCs. To confirm this need to check the firewall rules. VPC networks are by default isolated private networking domains. However, no internal IP address communication is allowed between networks, unless you set up mechanisms such as VPC peering or VPN.
 - The number of interfaces allowed in an instance is dependent on the instance's machine type and the number of vCPUs. The n1-standard-4 allows up to 4 network interfaces. Refer [here](https://cloud.google.com/vpc/docs/create-use-multiple-interfaces#max-interfaces) for more information.
</code></pre>

<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/devops/gcp/" title="GCP"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/devops/gcp/fundamentals/" title="Fundamentals" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1613331106"></script>
    <script src="/js/perfect-scrollbar.min.js?1613331106"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1613331106"></script>
    <script src="/js/jquery.sticky.js?1613331106"></script>
    <script src="/js/featherlight.min.js?1613331106"></script>
    <script src="/js/highlight.pack.js?1613331106"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1613331106"></script>
    <script src="/js/learn.js?1613331106"></script>
    <script src="/js/hugo-learn.js?1613331106"></script>

    <link href="/mermaid/mermaid.css?1613331106" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1613331106"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

